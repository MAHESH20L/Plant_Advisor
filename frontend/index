<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Organic Plant Disease Advisor</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* (same CSS you already have â€“ unchanged) */
</style>
</head>

<body>
<div class="app">
<h1>ðŸŒ± Organic Plant Disease Advisor</h1>

<div class="section chat-box" id="chat"></div>

<div class="section">
  <input type="file" id="leafImage" accept="image/*">
  <img id="preview">
</div>

<button id="analyzeBtn">Analyze</button>
<button id="pdfBtn" disabled>Download PDF</button>

<div id="error"></div>
<div id="output"></div>
</div>

<script>
const BACKEND_URL = "https://your-backend.onrender.com/analyze"; 
// ðŸ‘† CHANGE ONLY THIS when deployed

let leafBase64 = "";
let finalText = "";

document.getElementById("leafImage").addEventListener("change", e => {
  const reader = new FileReader();
  reader.onload = () => {
    leafBase64 = reader.result;
    document.getElementById("preview").src = leafBase64;
  };
  reader.readAsDataURL(e.target.files[0]);
});

async function analyzeLeaf() {
  const res = await fetch(BACKEND_URL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-api-token": "frontend-access-token"
    },
    body: JSON.stringify({ imageBase64: leafBase64 })
  });

  const data = await res.json();
  if (data.error) throw new Error(data.error);
  return data.result;
}

document.getElementById("analyzeBtn").onclick = async () => {
  try {
    finalText = await analyzeLeaf();
    document.getElementById("output").textContent = finalText;
    document.getElementById("pdfBtn").disabled = false;
  } catch {
    document.getElementById("error").textContent = "Analysis failed";
  }
};

document.getElementById("pdfBtn").onclick = () => {
  const pdf = new window.jspdf.jsPDF();
  pdf.text(finalText, 10, 15);
  pdf.save("Organic_Plant_Disease_Report.pdf");
};
</script>
</body>
</html>
